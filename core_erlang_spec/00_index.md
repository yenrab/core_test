# Core Erlang Language Specification

## Overview

This directory contains a comprehensive specification of the Core Erlang intermediate language used by the Erlang/OTP compiler. Core Erlang serves as a functional intermediate representation between Erlang source code and BEAM bytecode.

## Specification Structure

### 01_grammar_specification.md
Complete lexical and syntactic grammar for Core Erlang, including:
- Token definitions and lexical analysis
- Grammar rules for all language constructs
- Pattern matching syntax
- Annotation system
- Examples of valid Core Erlang syntax

### 02_ast_node_specifications.md
Detailed specifications of all Abstract Syntax Tree (AST) node types:
- Record definitions for all node types
- Field specifications and types
- Construction and manipulation helpers
- Pattern matching examples
- Type system definitions

### 03_language_semantics.md
Operational semantics and behavioral specifications:
- Evaluation model and strict evaluation
- Pattern matching semantics
- Exception handling
- Memory management
- Concurrency model
- Optimization semantics

### 04_message_passing_specification.md
Comprehensive message passing specifications with accurate examples:
- Send and receive operations
- Process communication patterns
- Request-response patterns
- Process supervision and linking
- Distributed messaging
- Message routing and filtering
- Performance considerations

## Core Erlang Characteristics

### Language Features
- **Functional**: Pure functional programming with immutable data
- **Strict Evaluation**: All arguments evaluated before function calls
- **Pattern Matching**: Primary control flow mechanism
- **Single Assignment**: Variables are bound once and immutable
- **First-class Functions**: Functions as values
- **Recursion**: Tail-recursive optimization support

### Data Types
- **Atoms**: Symbolic constants (`'hello'`, `'ok'`)
- **Numbers**: Integers and floats (`42`, `3.14`)
- **Strings**: Character sequences (`"hello"`)
- **Lists**: Linked lists (`[1, 2, 3]`)
- **Tuples**: Fixed-size collections (`{a, b, c}`)
- **Maps**: Key-value associations (`#{key => value}`)
- **Binaries**: Bit sequences (`<<1, 2, 3>>`)
- **Functions**: First-class function values
- **Processes**: Lightweight concurrent processes

### Control Structures
- **Pattern Matching**: `case` expressions with guards
- **Local Bindings**: `let` expressions
- **Recursive Definitions**: `letrec` expressions
- **Sequencing**: `do` expressions
- **Exception Handling**: `try-catch` expressions
- **Message Passing**: `receive` expressions

### Message Passing
- **Asynchronous**: Non-blocking message sending
- **Selective Receiving**: Pattern-based message filtering
- **Timeouts**: Bounded waiting with timeout actions
- **Process Links**: Bidirectional process relationships
- **Process Registration**: Named process lookup

## Implementation Notes

### Compiler Integration
Core Erlang is generated by the Erlang compiler from source code and serves as input to the BEAM code generator. The language is designed to:

- Preserve semantic information from source Erlang
- Enable compiler optimizations
- Support static analysis
- Facilitate code generation

### AST Representation
The AST uses Erlang records with:
- Consistent annotation field as first element
- Type-safe field specifications
- Helper functions for construction and manipulation
- Pattern matching for traversal and transformation

### Optimization Opportunities
Core Erlang enables various optimizations:
- **Tail Call Optimization**: Constant stack space for tail recursion
- **Constant Folding**: Compile-time evaluation of constants
- **Inlining**: Function call elimination
- **Dead Code Elimination**: Removal of unreachable code
- **Type Inference**: Compile-time type analysis

## Usage Examples

### Simple Function
```erlang
'factorial'/1 =
    fun (N) ->
        case N of
            <0> when 'true' -> 1
            <N> when 'true' -> 
                call 'erlang':'*'
                    (N, apply 'factorial'/1 (call 'erlang':'-' (N, 1)))
        end
```

### Message Passing
```erlang
'ping_pong'/0 =
    fun () ->
        let <PongPid> = call 'erlang':'spawn'
            (fun () -> apply 'pong'/0 ())
        in  do  call 'erlang':'!'
                    (PongPid, 'ping')
                receive
                    <'pong'> when 'true' -> 'ok'
                after 1000 -> 'timeout'
                end
```

### Process Supervision
```erlang
'supervisor'/0 =
    fun () ->
        let <WorkerPid> = call 'erlang':'spawn_link'
            (fun () -> apply 'worker'/0 ())
        in  receive
                <{'EXIT', WorkerPid, _Reason}> when 'true' ->
                    apply 'supervisor'/0 ()
            after 'infinity' ->
                'ok'
            end
```

## File Organization

Each specification file is designed to be:
- **Self-contained**: Complete information within each file
- **Cross-referenced**: Links to related concepts
- **Example-rich**: Practical code examples
- **LLM-optimized**: Structured for AI consumption
- **Human-readable**: Clear explanations and formatting

## Target Audience

This specification is designed for:
- **Compiler Developers**: Implementing Core Erlang support
- **Language Researchers**: Studying functional intermediate languages
- **AI Systems**: Understanding Core Erlang semantics
- **Tool Developers**: Building Core Erlang analysis tools
- **Students**: Learning about compiler intermediate representations

## Related Documentation

- **Erlang/OTP Documentation**: Source language reference
- **BEAM Virtual Machine**: Target platform specification
- **Compiler Internals**: Implementation details
- **Core Erlang Tools**: Development and analysis tools

## Version Information

This specification is based on:
- **Erlang/OTP Version**: 27.x
- **Core Erlang Version**: As implemented in compiler
- **Last Updated**: 2025
- **Specification Version**: 1.0

## Contributing

This specification is derived from the official Erlang/OTP compiler source code and should be updated when the language evolves. Key sources include:

- `/lib/compiler/src/core_parse.yrl` - Grammar definition
- `/lib/compiler/src/core_parse.hrl` - AST record definitions
- `/lib/compiler/src/cerl.erl` - AST manipulation functions
- `/lib/compiler/test/core_SUITE_data/` - Test examples

## License

This specification is provided under the same license as Erlang/OTP (Apache License 2.0).
